# 用户权限系统测试清单

## 测试环境准备

1. 确保使用 Redis/Kvrocks/Upstash 存储（不是 localstorage）
2. 配置站长账号环境变量
3. 启动应用

## 测试用例

### 1. 站长权限测试

#### 1.1 登录测试
- [ ] 使用站长账号登录成功
- [ ] 登录后可以访问 `/admin` 页面
- [ ] 可以看到所有管理功能标签

#### 1.2 用户管理测试
- [ ] 可以添加普通用户
- [ ] 可以添加管理员
- [ ] 可以修改任何用户的密码（包括管理员）
- [ ] 可以封禁/解封任何用户
- [ ] 可以删除任何用户（除了自己）
- [ ] 可以配置任何用户的采集源权限
- [ ] 可以配置任何用户的用户组

#### 1.3 系统管理测试
- [ ] 可以访问"配置文件"标签
- [ ] 可以访问"数据迁移"标签
- [ ] 可以重置系统配置
- [ ] 可以修改站点配置
- [ ] 可以管理视频源
- [ ] 可以管理直播源

### 2. 管理员权限测试

#### 2.1 登录测试
- [ ] 使用管理员账号登录成功
- [ ] 登录后可以访问 `/admin` 页面
- [ ] 看不到"配置文件"和"数据迁移"标签

#### 2.2 用户管理测试
- [ ] 可以添加普通用户
- [ ] 不能添加管理员（按钮不可见或操作失败）
- [ ] 可以修改普通用户的密码
- [ ] 可以修改自己的密码
- [ ] 不能修改其他管理员的密码
- [ ] 不能修改站长的密码
- [ ] 可以封禁/解封普通用户
- [ ] 不能封禁/解封其他管理员
- [ ] 可以删除普通用户
- [ ] 不能删除管理员
- [ ] 可以配置普通用户和自己的采集源权限
- [ ] 不能配置其他管理员的采集源权限

#### 2.3 系统管理测试
- [ ] 可以修改站点配置
- [ ] 可以管理视频源
- [ ] 可以管理直播源
- [ ] 不能重置系统配置
- [ ] 不能访问数据迁移功能

### 3. 普通用户权限测试

#### 3.1 登录测试
- [ ] 使用普通用户账号登录成功
- [ ] 登录后不能访问 `/admin` 页面（自动重定向到首页）
- [ ] 尝试直接访问 `/admin` 会被重定向

#### 3.2 观看功能测试
- [ ] 可以搜索视频
- [ ] 可以观看视频
- [ ] 可以添加收藏
- [ ] 可以查看播放记录
- [ ] 可以修改自己的密码

#### 3.3 限制测试
- [ ] 不能访问管理后台
- [ ] 不能修改系统配置
- [ ] 不能管理其他用户
- [ ] API 调用 `/api/admin/*` 返回 403 错误

### 4. 用户组功能测试

#### 4.1 创建用户组
- [ ] 站长可以创建用户组
- [ ] 管理员可以创建用户组
- [ ] 可以为用户组配置采集源权限

#### 4.2 分配用户组
- [ ] 添加用户时可以选择用户组
- [ ] 可以为现有用户配置用户组
- [ ] 可以批量设置用户组

#### 4.3 用户组权限
- [ ] 用户继承用户组的采集源权限
- [ ] 用户个人权限和用户组权限可以合并

#### 4.4 删除用户组
- [ ] 删除用户组时会显示受影响的用户
- [ ] 删除用户组后，用户的用户组标签被移除
- [ ] 删除用户组不影响用户的个人采集源权限

### 5. 采集源权限测试

#### 5.1 配置采集源权限
- [ ] 可以为用户配置可访问的采集源
- [ ] 未配置采集源的用户可以访问所有采集源
- [ ] 配置后用户只能访问指定的采集源

#### 5.2 权限生效测试
- [ ] 用户搜索时只显示有权限的采集源结果
- [ ] 用户播放时只能播放有权限的采集源内容

### 6. 安全性测试

#### 6.1 认证测试
- [ ] 未登录用户访问任何页面都会重定向到登录页
- [ ] Cookie 过期后需要重新登录
- [ ] 签名验证失败会被拒绝访问

#### 6.2 权限绕过测试
- [ ] 普通用户直接访问 `/admin` 被拒绝
- [ ] 普通用户调用 `/api/admin/*` 返回 403
- [ ] 管理员尝试操作其他管理员被拒绝
- [ ] 管理员尝试访问站长专属功能被拒绝

#### 6.3 密码安全测试
- [ ] 密码使用 SHA-256 加密存储
- [ ] 不能查看其他用户的密码
- [ ] 修改密码需要适当的权限

### 7. 边界情况测试

#### 7.1 用户删除
- [ ] 删除用户后该用户无法登录
- [ ] 删除用户后该用户的数据被清理
- [ ] 不能删除自己

#### 7.2 用户封禁
- [ ] 被封禁的用户无法登录
- [ ] 被封禁的用户显示"用户被封禁"错误
- [ ] 解封后用户可以正常登录

#### 7.3 角色变更
- [ ] 普通用户升级为管理员后获得管理权限
- [ ] 管理员降级为普通用户后失去管理权限
- [ ] 角色变更立即生效

## 测试结果记录

测试日期：__________
测试人员：__________
环境信息：__________

| 测试项 | 通过 | 失败 | 备注 |
|--------|------|------|------|
| 站长权限 | ☐ | ☐ | |
| 管理员权限 | ☐ | ☐ | |
| 普通用户权限 | ☐ | ☐ | |
| 用户组功能 | ☐ | ☐ | |
| 采集源权限 | ☐ | ☐ | |
| 安全性 | ☐ | ☐ | |
| 边界情况 | ☐ | ☐ | |

## 已知问题

（记录测试中发现的问题）

## 改进建议

（记录测试中发现的可改进之处）
